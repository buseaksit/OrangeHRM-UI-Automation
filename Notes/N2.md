# waitFor
- Web Ui load things asyncronously, network latency, animations etc.
- Sometimes we may need to wait additionaly for some elements to be displayed, not visible etc.

## There are 4 wait families in Playwright
1. **Locator Waits**
    * `locator.waitFor({state})`: Wait for one element to appear/disappear.
2. **Page Waits**
    * `page.waitFor()`: Wait for page level conditions. URL change, network idle, route finished.
3. **Event waits** 
    * `await page.waitForEvent('download')`: Wait for a browser event. File dowloads, dialogs.

### 1. Locator `.waitFor()`   
```js
await page.locator('locating').waitFor({state:-stateValue-});
```
* State value could be:
   - visible  :
   - hidden   : Still in the dom but not displayed.(display:none)
   - attached : Exist in the DOM(visibility is irrelevant.)
   - detached : Removed from the DOM tree entirely.   

### 2. Page level waits
```js
await page.waitForURL('**/dashboard'); // wait till the url ends with dashboard   
await page.waitForLoadState('networkidle'); // no network for 500ms
await page.waitForSelector(); // you could use it as waitFor for locators.
await page.waitForEvent('download'); // file download.
```

# Runner File In Playwright 
- Runner file: A signal js module often named as `runner-fixtures.js` or `test-setup.js`
that extends playwright's built in test object.
- Let us run custom fixtures(helpers, shortcuts) and global hooks(`beforeAll`, `afterAll`) 
in one place. Every spec file just imports your runner and inherits necessary methods/functions.

1. Import it in any `.spec` file.
   - `import {test, expect} from 'runner-fixtures.js'`
2. Write tests as usual.
3. If you need another helper like `quickNav`, add a property inside
`base.extend({...})`
```js
export const test = base.extend({
   // ..... exisiting fixtures
   randEmail: async({},use) => {
    const email = `random${Date.now()}@gmail.com`
    await use(email);
   }
})   
```
With above every test can now use
```js
test('createUser', async({page, randEmail}) =>{
    await page.fill('#email')
})
```

# Environment Variable Management For A Framework
## 1. `dotenv`
- Loads key value pairs from a file into `process.env` at runtime.
- Keeps credentials & URL's out of source code. New people that we share our 
framework clones, runs `npm install`, drops `.env` and the suite will just work.
- How to use: Called once in `scripts/load-config.js`, so every spec/helper inherits
the same environment without adding `import 'dotenv/config'`.

## 2. `dotenv-expand` 
- Lets one eenv var reference another. (URL = ${BASE_URL}/navigation).
- We could use this for compount settings, api routes etc.
- Chained after `dotenv.config()`, expands placehodlers before validation.

## 3. `envalid`
- Runtime type-checker for enviroment variables. Fails fast if a required key is missing or 
the wrong type.
- Stops flakines in code, and errors surface before Playwright boots.

## 4. `cross-env`
- Sets env vars on the command line in a cross platform way. (Windows, UNix, Linux)
- We could edit the variables in same way regardless of operating system. 
- We use it in scripts section of `package.json`. 