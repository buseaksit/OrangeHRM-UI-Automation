# Global Setup In PW
- Global setup runs once and creates or executes any file that should run
before tests.
- Prepares shared state that every test run can reuse: login tokens, DB connections, 
temp files, feature flags etc.
- This setup is created in `playwright.config.js` by pointing the `globalSetup` key at 
a file/function or via project dependecies.
- It should not be used if the setup is isolated per test or repeated each test
file.

# 2 ways to add Global setup in your project
- Classic `globalSetup` key
  * It is not visible in HTML report.(Results of the tests).
  * It doesnt Trace/video for setup
  * No parallel run
  * Easy setup

- Project Dependency.
  * Shows in the html report.
  * It captures the video automatically.
  * Access to playwright fixtures(page,browser..)
  * Allows parallel run
  * Needs extra steps to setup.

# `playwright.config.js`
1. What is this file?
* Configuration hub for the playwright test runner
   * Think of as settings page for playwright runner.

## `package.json`
* This is a manifest file for every Node/JS project.
* NPM(Node package manager) reads it to know which libraries to install.
* Your IDE (visual studio code) reads it for automcompleteion and lint rules.
* CI servers read it to figure out which commands to run.
Without *`package.json`* a JavaScript repo is just a pile of `.js` files with no
guarenteed way to reproduce same setup somewhere else.

* **What can/should we adjust in *`package.json`***?
     - **name/version/description**
       * pick a clear name; add a one-line description so anyone that looks at this 
       project knows its purpose.
       * Version matters if you ever publish the package; otherwise it's mostly 
       informational.
     - **main**
       * Only relevant if you expect others to `require('orange-pw-automation')`
       * A test suite doesnt't export the code, so removing or ignoring main is fine.
     - **directories**  
       * No need in modern tools. Safe to delete/ignore.
     - **scripts**
       * The heart of day-to-day work. Replace the placeholder with real commands:
       ```jsonc
          "scripts":{
              "test": "playwright test",
              "ui"  : "playwright test --ui",  // visual test explorer
              "update:auth": "node utils/storageStateUtils.js",
              "report": "playwright show-report"

          } 
        ```
    - **type** (CommonJs vs ESModule)
       * `"common.js"` means you must write `const{test }= require('library')`
       * If you prefer `import {test} from 'library'` then you must remove this key 
       completely or switch to `module`.
       * Pick one style and stay consistent.
     - **`devDependencies`** vs **`dependencies`**
        - Any library only required during development(PW testrunner, TypeScript)
        should be in dev dependencies. 
        - Anything required when the code runs in production goes into dependencies. 
        - For a pure PW test repor you rarely need `playwright` in `dependencies`; you can move it to `devDependencies` because the tests themselves are not a prodcution runtime code. 
        - So our *`package.json`* for the dependencies should look like: 
        ```jsonc
        "devDependencies": {
        "@playwright/test": "^1.54.1",
        "playwright": "^1.54.1"
        },
        "dependencies": {}
        ```  
        - SIDE NOTE: `playwright-core` is usually only for bundlers or custom browser
        downloads. You can remove it unless you need that special case. 
    - **`author`/`licence`/`keywords`**
        * Fill them in if the repo is public; otherwise they are optional. 
        * You could add `"private":true` at top level to prevent accidental 
        `npm publish` which could make the test project public. 

* **How do I run tests?**
    1. Install the dependencies. 
        ```bash
        npm install             # reads package.json and populates node_modules
        npx playwright install  # downloads Chromium, Firefox, Webkit binaries.
        ```
    2. Add a Playwright Config
        I. At repo root, add `playwright.config.js`.
            This is the single place Playwright looks for configuration unless you 
            pass `--config` on the CLI. 
        II. Decide on module system. 
            * If your *`package.json`* has `"type":"common.js"` write `require()` + `module.exports`. 
            * If you prefer `import` syntax, flip `"type":"module"` or delete the key. 
            Pick one style and stay consistent. 
        III. Import playwright's helper
            * Bring in `defineConfig`. 
        ```js
            // ESM
            import { defineConfig} from '@playwright/test'
            // commonJS
            const {defineConfig} = require("@playright/test");
        ```
        IV. Reference the storageState file. 
            * Create a constant holding `auth/orangeHrm.auth.json` so you never 
            hard code the path twice. 
        V. Build the use block
            * Inside `defineConfig({...})` add a use object. 
                * `baseURL`. 
                * `storageState`
                * Optional extras: `headless`, `trace: 'on-first-retry'`, `screenshot: 'only-on-failure'` 
        VI. Describe your projects
            * Projects let you run the same tests in different browsers or
            devices. 
            * Minimal Single project setup: 
                ```js
                projects: [ {name: 'chromium' }]
                 ```
        VII. Handy global toggles to include early on: 
            * `timeout`: max per-test runtime(default 30s)
            * `retries`: atomatic flake re-runs.
            * `reporter`: stick with `html` first, then later we can use
            advance `json` or `allure` reports. 
            * `outputDir`: where traces, screenshots, and videos land. 

        VIII. Export the config. 
            * Wrap everything in `export default defineConfig({...})`(ESM)
            or `module.exports = defineConfig({...})` (CJS). 
            * Playwright read it syncronously when you execute `npx playwright test`. 
               

